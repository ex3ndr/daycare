import { databaseMigrate } from "./databaseMigrate.js";
import { databaseOpenTest } from "./databaseOpenTest.js";
import { Storage } from "./storage.js";

/**
 * Opens in-memory test storage, applies migrations, and returns Storage facade.
 * Expects: optional key is stable when a test needs reopen semantics.
 */
export function storageOpenTest(key?: string): Storage {
    const db = databaseOpenTest(key);
    databaseMigrate(db);
    return Storage.fromDatabase(db);
}
